<local:UserTab x:Class="COTG.Views.AttackTab"
               Tag="Attack"
               xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
               xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
               xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
               xmlns:game="using:COTG.Game"
               xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
               xmlns:cotg="using:COTG"
               xmlns:winui="using:Microsoft.UI.Xaml.Controls"
               xmlns:tk="using:Microsoft.Toolkit.Uwp.UI.Controls"
               xmlns:local="using:COTG.Views"
               d:DataContext="{d:DesignInstance Type=local:ShellPage}"
			   TabNavigation="Once"
			  IsTabStop="True"
               mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <tk:WrapPanel Orientation="Horizontal">
			<ToggleButton x:Name="includeSEAttack" Content="SE Demo" IsEnabled="True" />
			<ToggleButton x:Name="includeSennySiege" Content="Senny Siege" IsEnabled="False" />
            <winui:NumberBox x:Name="maxTravelHours"
                             Header="Max travel hours"
                             Style="{StaticResource NumberBoxSmall}"
                             Value="12"
                             ToolTipService.ToolTip="Attacks that would take longer than this to arrive are removed"
                             NumberFormatter="{x:Bind cotg:App.formatter2Digit,Mode=OneTime}"
                             SmallChange="0.25" />
            <winui:NumberBox x:Name="maxFakes"
                             Header="Max fakes"
                             ToolTipService.ToolTip="The maximum number of fakes, if there are more fakes provided, the closest ones will be used"
                             Style="{StaticResource NumberBoxSmall}"
                             Value="4"
                             NumberFormatter="{x:Bind cotg:App.formatterInt,Mode=OneTime}"
                             SmallChange="1" />
            <winui:NumberBox x:Name="minAssaults"
                             Header="Min Assaults"
                             ToolTipService.ToolTip="For Demos only - if assults are culled due to distance and there are fewer assaults than this left, the target will be discarded"
                             Style="{StaticResource NumberBoxSmall}"
                             Value="4"
                             NumberFormatter="{x:Bind cotg:App.formatterInt,Mode=OneTime}"
                             SmallChange="1" />
            <Button Content="Remove Selected"
                    VerticalAlignment="Center"
                    Margin="4"
                    HorizontalAlignment="Center"
                    Style="{StaticResource ButtonSmall}"
                    ToolTipService.ToolTip="Remove selected Attacks or Targets"
                    Click="RemoveSelected_Click" />

            <Button Content="Add Attacks from Clipboard"
                    VerticalAlignment="Center"
                    Margin="4"
                    HorizontalAlignment="Center"
                    ToolTipService.ToolTip="Extracts coordinates from the clipboard and adds attacks"
                    Style="{StaticResource ButtonSmall}"
                    Click="AddAttacksFromClipboard" />
            <Button Content="Add Attacks from Clipboard (form)"
                    VerticalAlignment="Center"
                    Margin="4"
                    HorizontalAlignment="Center"
                    ToolTipService.ToolTip="Adds attacks based on coordinates and other data from the clipboard copied from sheets"
                    Style="{StaticResource ButtonSmall}"
                    Click="AddAttacksFromSheets" />
            <Button Content="Add Targets from Clipboard"
                    VerticalAlignment="Center"
                    Margin="4"
                    HorizontalAlignment="Center"
                    ToolTipService.ToolTip="Extracts coordinates from the clipboard and adds fakse, you can later select which are real"
                    Style="{StaticResource ButtonSmall}"
                    Click="AddTargetsFromClipboard" />
            <Button Content="Sort"
                    VerticalAlignment="Center"
                    Margin="4"
                    HorizontalAlignment="Center"
                    Style="{StaticResource ButtonSmall}"
                    ToolTipService.ToolTip="Sort attacks by player"
                    Click="SortAttacks" />

         
                <Button x:Name="arrival"
                           VerticalAlignment="Center"
                           Content="Arrival..."
						Margin="4"
                           HorizontalAlignment="Center"
                           Click="ArrivalTapped"
                            Style="{StaticResource ButtonSmall}"
                           ToolTipService.ToolTip="Time at which attacks arrive." />
        </tk:WrapPanel>
        <tk:WrapPanel Orientation="Horizontal"
                      Margin="4"
                      HorizontalSpacing="4"
                      VerticalSpacing="4"
					  
                      Grid.Row="1">

            <Border 
                    Style="{StaticResource BorderReveal}">
                <TextBlock x:Name="attackCount"
                           Margin="4"
                           x:FieldModifier="public"
                           IsTextSelectionEnabled="True" />
            </Border>
            <Border 
                    Style="{StaticResource BorderReveal}">
                <TextBlock x:Name="vanqs"
                           Margin="4"
                           x:FieldModifier="public"
                           IsTextSelectionEnabled="True" />
            </Border>
            <Border 
                    Style="{StaticResource BorderReveal}">
                <TextBlock x:Name="SE"
                           Margin="4"
                           x:FieldModifier="public"
                           IsTextSelectionEnabled="True" />
            </Border>
            <Border 
                    Style="{StaticResource BorderReveal}">
                <TextBlock x:Name="sorcs"
                           Margin="4"
                           x:FieldModifier="public"
                           IsTextSelectionEnabled="True" />
            </Border>
            <Border 
                    Style="{StaticResource BorderReveal}">
                <TextBlock x:Name="druids"
                           Margin="4"
                           x:FieldModifier="public"
                           IsTextSelectionEnabled="True" />
            </Border>
            <Border 
                    Style="{StaticResource BorderReveal}">
                <TextBlock x:Name="horses"
                           Margin="4"
                           x:FieldModifier="public"
                           IsTextSelectionEnabled="True" />
            </Border>
        </tk:WrapPanel>
        <tk:DataGrid x:Name="attackGrid"
                     x:FieldModifier="public"
                     AutoGenerateColumns="False"
                     ItemsSource="{x:Bind local:AttackTab.attacks, Mode=OneWay}"
                     RowHeight="{StaticResource GridRowHeight}"
                     Grid.Row="2"
                     SelectionMode="Extended"
                     RowDetailsVisibilityMode="Collapsed"
                     CanUserReorderColumns="True"
                     CanUserSortColumns="True"
                     GridLinesVisibility="All"
                     AlternatingRowBackground="#FF301030">
            <tk:DataGrid.Columns>
                <tk:DataGridTextColumn Header="Player"
                                       Binding="{Binding player, Mode=OneTime}" />
                <tk:DataGridTemplateColumn Header="Source">
                    <tk:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate x:DataType="game:Attack">
                            <HyperlinkButton Content="{x:Bind xy}"
                                             Tapped="AttackSourceCoord_Tapped"
                                             HorizontalAlignment="Center"
                                             HorizontalContentAlignment="Center"
                                             ToolTipService.ToolTip="The city to attack from" />
                        </DataTemplate>
                    </tk:DataGridTemplateColumn.CellTemplate>
                </tk:DataGridTemplateColumn>
                <tk:DataGridTemplateColumn Header="Target">
                    <tk:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate x:DataType="game:Attack">
                            <HyperlinkButton Content="{x:Bind attackCluster}"
                                             Tapped="AttackTargetCoord_Tapped"
                                             HorizontalAlignment="Center"
                                             HorizontalContentAlignment="Center"
                                             ToolTipService.ToolTip="The target to attack" />
                        </DataTemplate>
                    </tk:DataGridTemplateColumn.CellTemplate>
                </tk:DataGridTemplateColumn>
                <tk:DataGridComboBoxColumn  Header="Type"
                                            Binding="{Binding type,Mode=OneTime}"
                                            ItemsSource="{x:Bind game:AttackType.types , Mode=OneTime}"
                                            DisplayMemberPath="name" />
                <tk:DataGridCheckBoxColumn Header="Fake"
                                           Binding="{Binding fake, Mode=OneTime}" />
                <tk:DataGridTextColumn Header="tt"
                                       Binding="{Binding troopTypeString, Mode=OneTime}" />
                <tk:DataGridTextColumn Header="ts"
                                       Binding="{Binding ts, Mode=OneTime}" />
                <tk:DataGridTemplateColumn Header="Remove">
                    <tk:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate x:DataType="game:Attack">
                            <HyperlinkButton Content="Remove"
                                             Tapped="AttackRemove_Tapped"
                                             HorizontalAlignment="Center"
                                             HorizontalContentAlignment="Center"
                                             ToolTipService.ToolTip="Remove this Attack" />
                        </DataTemplate>
                    </tk:DataGridTemplateColumn.CellTemplate>
                </tk:DataGridTemplateColumn>
            </tk:DataGrid.Columns>
        </tk:DataGrid>
        <tk:WrapPanel Orientation="Horizontal"
                      Margin="4"
                      HorizontalSpacing="4"
                      VerticalSpacing="4"
                      Grid.Row="5">
            <Border 
                    Style="{StaticResource BorderReveal}">
                <TextBlock x:Name="realCount"
                           Margin="4"
                           x:FieldModifier="public"
                           IsTextSelectionEnabled="True" />
            </Border>
            <Border 
                    Style="{StaticResource BorderReveal}">
                <TextBlock x:Name="fakeCount"
                           Margin="4"
                           x:FieldModifier="public"
                           IsTextSelectionEnabled="True" />
            </Border>

            <Border 
                    Style="{StaticResource BorderReveal}">
                <TextBlock x:Name="sePerTarget"
                           Margin="4"
                           x:FieldModifier="public"
                           IsTextSelectionEnabled="True" />
            </Border>
            <Border 
                    Style="{StaticResource BorderReveal}">
                <TextBlock x:Name="attacksPerTarget"
                           Margin="4"
                           x:FieldModifier="public"
                           IsTextSelectionEnabled="True" />
            </Border>
        </tk:WrapPanel>
        <tk:WrapPanel Orientation="Horizontal"
                      Margin="4"
                      HorizontalSpacing="4"
                      VerticalSpacing="4"
                      Grid.Row="4">
            <Button Content="Create Plan"
                    VerticalAlignment="Center"
                    Margin="4"
                    HorizontalAlignment="Center"
                    Style="{StaticResource ButtonSmall}"
                    Click="AssignAttacks_Click" />
            <Button Content="Export"
                    VerticalAlignment="Center"
                    Margin="4"
                    HorizontalAlignment="Center"
                    Style="{StaticResource ButtonSmall}"
                    Click="AttackSender_Tapped" />
            <Button Content="Clear Targets"
                    VerticalAlignment="Center"
                    Margin="4"
                    HorizontalAlignment="Center"
                    Style="{StaticResource ButtonSmall}"
                    Click="ClearTargets_Click" />
        </tk:WrapPanel>
        <tk:GridSplitter Grid.Row="3"
                         ResizeDirection="Rows"
                         Height="11"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Top"
                         Background="Transparent">
            <tk:GridSplitter.Element>
                <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}"
                          Glyph="&#xE76F;"
                          IsHitTestVisible="False" />
            </tk:GridSplitter.Element>
        </tk:GridSplitter>

        <tk:DataGrid x:Name="targetGrid"
                     x:FieldModifier="public"
                     AutoGenerateColumns="False"
                     Grid.Row="6"
                     ItemsSource="{x:Bind local:AttackTab.targets, Mode=OneWay}"
                     RowHeight="24"
                     GridLinesVisibility="All"
                     SelectionMode="Extended"
                     AlternatingRowBackground="#FF103020">
            <tk:DataGrid.Columns>
                <tk:DataGridTemplateColumn Header="Icon">
                    <tk:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate x:DataType="game:Spot">
                            <Image Source="{x:Bind icon,Mode=OneTime}"
                                   HorizontalAlignment="Center"
                                   Stretch="UniformToFill"
                                   VerticalAlignment="Center" />
                        </DataTemplate>
                    </tk:DataGridTemplateColumn.CellTemplate>
                </tk:DataGridTemplateColumn>
                <tk:DataGridTemplateColumn Header="xy">
                    <tk:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate x:DataType="game:Spot">
                            <HyperlinkButton Content="{x:Bind xy, Mode=OneTime}"
                                             Tapped="TargetCoord_Tapped"
                                             HorizontalAlignment="Center"
                                             HorizontalContentAlignment="Center"
                                             ToolTipService.ToolTip="The target to attack" />
                        </DataTemplate>
                    </tk:DataGridTemplateColumn.CellTemplate>
                </tk:DataGridTemplateColumn>
                <tk:DataGridTextColumn Header="Player"
                                       Binding="{Binding player, Mode=OneTime}" />
                <tk:DataGridCheckBoxColumn Header="Fake"
                                           Binding="{Binding attackFake, Mode=OneTime}" />
                <tk:DataGridTextColumn Header="Cluster"
                                       Binding="{Binding attackCluster, Mode=OneWay}"
                                       IsReadOnly="True" />
                <tk:DataGridTextColumn Header="City"
                                       Binding="{Binding cityName, Mode=OneTime}" />
                <tk:DataGridTextColumn Header="Alliance"
                                       Binding="{Binding alliance, Mode=OneTime}" />
                <tk:DataGridTextColumn Header="Intel"
                                       Binding="{Binding classificationString, Mode=OneTime}" />
                <tk:DataGridTemplateColumn Header="Remove">
                    <tk:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate x:DataType="game:Spot">
                            <HyperlinkButton Content="Remove"
                                             Tapped="TargetRemove_Tapped"
                                             HorizontalAlignment="Center"
                                             HorizontalContentAlignment="Center"
                                             ToolTipService.ToolTip="Remove this Target" />
                        </DataTemplate>
                    </tk:DataGridTemplateColumn.CellTemplate>
                </tk:DataGridTemplateColumn>

            </tk:DataGrid.Columns>
        </tk:DataGrid>
    </Grid>
</local:UserTab>
