<view:UserTab
      x:Class="COTG.Views.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:tg="using:Telerik.UI.Xaml.Controls.Grid"
      xmlns:tk="using:Microsoft.Toolkit.Uwp.UI.Controls"
      xmlns:winui="using:Microsoft.UI.Xaml.Controls"
      xmlns:model="using:COTG.Models"
      xmlns:game="using:COTG.Game"
      xmlns:view="using:COTG.Views"
      mc:Ignorable="d"
      Background="{x:Null}">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="34" />
            <RowDefinition Height="3*" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <ComboBox x:Name="cityListBox"
                  Width="200"
                  IsEditable="True"
                  SelectedValuePath="id"
                  DisplayMemberPath="name"
                  ItemsSource="{x:Bind cityListSelections, Mode=OneWay}"
                  VerticalAlignment="Center"
                  Margin="10,0,0,0" />
        <tg:RadDataGrid x:Name="cityGrid"
                        ColumnResizeHandleDisplayMode="Always"
                        Grid.Row="1"
                        UseSystemFocusVisuals="True"
                        IsTabStop="True"
                        GridLinesThickness="1.0"
                        AlternationStep="2"
                        ItemsSource="{x:Bind gridCitySource, Mode=OneWay}"
                        AutoGenerateColumns="False"
                        SelectionMode="Extended"
                        CanUserChooseColumns="True"
                        RowHeight="34"
                        PointerMoved="CityGrid_PointerMoved"
                        PointerPressed="CityGrid_PointerPress"
                        PointerExited="cityGrid_PointerExited"
                        FontSize="12"
                        GroupPanelPosition="Bottom"
                        SelectionUnit="Row">
            <tg:RadDataGrid.Commands>
                <model:CityGridToggleColumnVisibilityCommand />
            </tg:RadDataGrid.Commands>
            <tg:RadDataGrid.Columns>
                <tg:DataGridImageColumn PropertyName="icon"
                                        SizeMode="Fixed"
                                        Width="40" />
                <tg:DataGridTextColumn PropertyName="cityName"
                                       CellContentStyle="{StaticResource LeftAlign}"
                                       SizeMode="Auto"
                                       Width="100" />
                <tg:DataGridTextColumn PropertyName="xy"
                                       Width="80" />
                <tg:DataGridNumericalColumn PropertyName="tsTotal"
                                            CellContentStyle="{StaticResource RightAlign}"
                                            CellContentFormat="{}{0,7:N0}"
                                       Width="80" />
                <tg:DataGridNumericalColumn PropertyName="tsHome"
                                            CellContentStyle="{StaticResource RightAlign}"
                                            CellContentFormat="{}{0,7:N0}"
                                       Width="80" />
                <tg:DataGridNumericalColumn PropertyName="raidReturn"
                                            CellContentStyle="{StaticResource RightAlign}"
                                            CellContentFormat="{}{0,6:N0}"
                                            
                                            Width="50" />
                <tg:DataGridNumericalColumn PropertyName="raidCarry"
                                            CellContentStyle="{StaticResource RightAlign}"
                                            CellContentFormat="{}{0,5:N1}"
                                            Width="80"
                                             />
                <tg:DataGridNumericalColumn PropertyName="points"
                                            CellContentStyle="{StaticResource RightAlign}"
                                            CellContentFormat="{}{0,6:N0}"
                                            Width="80" />
                <tg:DataGridTextColumn PropertyName="remarks"
                                       CellContentStyle="{StaticResource LeftAlign}"
                                       Width="60"
                                       IsVisible="False" />
                <tg:DataGridTextColumn PropertyName="senny"
                                       CellContentStyle="{StaticResource LeftAlign}"
                                       Width="40"
                                       IsVisible="False" />
                <tg:DataGridBooleanColumn PropertyName="isCastle"
                                          IsVisible="False"
                                          Width="40" />
                <tg:DataGridNumericalColumn PropertyName="carryCapacity"
                                            CellContentStyle="{StaticResource RightAlign}"
                                            CellContentFormat="{}{0,8:N0}"
                                            IsVisible="False"
                                            Width="80" />
                <tg:DataGridNumericalColumn PropertyName="activeCommands"
                                            CellContentStyle="{StaticResource RightAlign}"
                                            CellContentFormat="{}{0,2:N0}"
                                            IsVisible="False"
                                            Width="40" />
                <tg:DataGridNumericalColumn PropertyName="commandSlots"
                                            CellContentStyle="{StaticResource RightAlign}"
                                            CellContentFormat="{}{0,2:N0}"
                                            IsVisible="False"
                                            Width="40" />
            </tg:RadDataGrid.Columns>
          
        </tg:RadDataGrid>
        <ComboBox x:Name="raidCarryBox" Grid.Row="2" Header="Carry%" SelectionChanged="RaidCarrySelChanged"
                  Width="200" IsEditable="True"
TextSubmitted="RaidCarrySubmitted"
                  Margin="8,2,0,0" >
            
        </ComboBox>
        <tg:RadDataGrid x:Name="dungeonGrid"
                        Margin="0,54,0,0"
                        UseSystemFocusVisuals="True"
                        AlternationStep="2"
                        UserGroupMode="Disabled"
                        AutoGenerateColumns="False"
                        SelectionMode="Single"
                        RowHeight="34"
                        FontSize="12"
                        Grid.Row="2"
                        CanUserChooseColumns="True"
                        UserSortMode="Auto"
                        SelectionUnit="Row"
                       >
            
            <tg:RadDataGrid.Commands>
                <model:DungeonTapCommand />
            </tg:RadDataGrid.Commands>
            <tg:RadDataGrid.Columns>
                <tg:DataGridNumericalColumn PropertyName="dist" />
                <tg:DataGridTextColumn PropertyName="plan" />
                <tg:DataGridNumericalColumn PropertyName="level" />
                <tg:DataGridNumericalColumn PropertyName="completion"
                                            CellContentFormat="{}{0,6:N1}" />
                <tg:DataGridTextColumn PropertyName="kind" />
                <tg:DataGridTextColumn PropertyName="xy" />
            </tg:RadDataGrid.Columns>
        </tg:RadDataGrid>
        <tk:GridSplitter Grid.Row="2"
                         ResizeDirection="Rows"
                                                 Height="20"
                         HorizontalAlignment="Stretch"
                         VerticalAlignment="Top"
                           Background="Transparent"
                    >
            <tk:GridSplitter.Element>
                <FontIcon FontFamily="{StaticResource SymbolThemeFontFamily}" Glyph="&#xE76F;"
                     IsHitTestVisible="False"    />
            </tk:GridSplitter.Element>
        </tk:GridSplitter>
        <winui:TeachingTip x:Name="TipRaiding101"
                                Title="Raiding 101"
                                Target="{x:Bind cityGrid}"
                                CloseButtonClick="TipRaiding101_ActionButtonClick"
                               CloseButtonContent="Got It"
                           PreferredPlacement="LeftTop"
                                Subtitle="See which cities have available troops by clicking on the 'tsHome' column header">
                <TextBlock  TextWrapping="Wrap">
                This will sort your cities by their TS at home<LineBreak/>
                Select the city for which you want to set raids<LineBreak/>
                Note: Click the column twice to sort in descending order<LineBreak/>
                </TextBlock>
        </winui:TeachingTip>
            
            <winui:TeachingTip x:Name="TipRaiding102"
                                Title="Dungeons 101"
                               CloseButtonContent="Success"
                            PreferredPlacement="LeftTop"
                                Target="{x:Bind dungeonGrid}"
                                Subtitle="Click on a dungeon that you would like to send raids to">
            <TextBlock  TextWrapping="Wrap">                    
                    <LineBreak/>You often want to select a dungeon appropriate for your troop type:
                    <LineBreak/>    -   Mountain for Infantry
                    <LineBreak/>    -   Hills for Magic
                    <LineBreak/>    -   Forests for Cavalry
                <LineBreak/>Clicking on the coordinates will show you the dungeon, clicking anywhere else will send raids
            </TextBlock>
        </winui:TeachingTip>
        <winui:TeachingTip x:Name="TipRaiding201"
                                Title="Home Please"
                                Target="{x:Bind cityGrid}"
                                CloseButtonClick="TipRaiding201_ActionButtonClick"
                               CloseButtonContent="Thank You"
                           PreferredPlacement="Left" >
            <TextBlock TextWrapping="Wrap">
                    <LineBreak/>The 'raidReturn' column tells you when (in minutes) the city raiders will reach their current destination.
                    <LineBreak/>    -   If the number is positive, they are returning
                    <LineBreak/>    -   If negative, they are on their way to the dungeon
                    <LineBreak/>    -   999 means that there are no raids 
                    <LineBreak/>If you right-click on a city, you will see the commands 'Home Please' and 'Home Whenever'
                    <LineBreak/>    -   If raiders are returning from a dungeon, 'Home Please' and 'Home Whenever' are the same.
                    <LineBreak/>    -   If the raiders are on their way to a dungeon, 'Home Please' will tell them to come home immediately, without loot.
                    <LineBreak/>    -   'Home Whenever' will tell them to complete the current raid, bring home the loot and then wait at home, watching TV and eating pizza until you order them out.</TextBlock>
        </winui:TeachingTip>
        <winui:TeachingTip x:Name="TipRaiding202"
                                Title="Shortcuts Please, Whenever"
                                Target="{x:Bind cityGrid}"
                                CloseButtonClick="TipRaiding202_ActionButtonClick"
                               CloseButtonContent="Thank You"
                           PreferredPlacement="Left" >
            <TextBlock TextWrapping="Wrap">
                     Clicking on the "Raid Return" cell of city is a shortcut for issuing the 'Home Please' context action<LineBreak/>
                     Clicking on the "Carry Capacity" cell of city is a shortcut for issuing the 'Home Whenever' context action<LineBreak/>
                     If the "Raid Return" is negative and close to 0, the raiders just left<LineBreak/>
                    If you ask them to "Return Please" they might teleport home instantly for you through various small temporary personal portals</TextBlock>
        </winui:TeachingTip>
        <winui:TeachingTip x:Name="TipRaiding203"
                                Title="Multiple Selection"
                                Target="{x:Bind cityGrid}"
                               CloseButtonContent="Good to Know"
                           PreferredPlacement="LeftBottom" >
            <TextBlock  TextWrapping="Wrap">
                     You can select multiple cities to issue commands to all selected<LineBreak/>
                     Use ctrl-click, shift-click, ctrl-a or arrows and the spacebar to select cities<LineBreak/>
                     When not pressing shift or control, be careful where you click.
                <LineBreak/>    -   Some cells might issue commands
                <LineBreak/>    -   It is usually safest to click on the city name to minimize unexpected actions
                <LineBreak/>    -   Enthusiastic use of the control key can help as nothing <Italic>should</Italic> happen other than selection when shift or control are pressed
                <LineBreak/>    -   Example:  Select a citylist in the box at the top of the cities grid
                <LineBreak/>        -   Give the city grid keyboard focus (tap on a city name)
                <LineBreak/>        -   Press ctrl-a to select all
                <LineBreak/>        -   Right click on a city and issue 'Return Whenever'</TextBlock>
        </winui:TeachingTip>
        <winui:TeachingTip x:Name="TipRaiding301"
                                Title="Carry Capacity"
                                Target="{x:Bind cityGrid}"
                               CloseButtonContent="Done with tips"
                           PreferredPlacement="LeftBottom" >
            <TextBlock TextWrapping="Wrap">
                Carry capacities below ~70 result in more raiding losses and raiding capacities above 100 provide less income.<LineBreak/>
                As dungeons progress, their availalbe loot per raid goes up, and so does the number of monsters encountered per raid.<LineBreak/>
                An approach to balance raiding losses vs returns is to start raids at around 115% carry capactiy, and reset them when they drop below 70%.<LineBreak/>
                Example:
                <LineBreak/>    -   Set the target carry capacity to 115%                
                <LineBreak/>    -   During a moment of enthusiasm
                <LineBreak/>        -   Sort all raids by carry capacity
                <LineBreak/>        -   select all below 70 and bring them home
                <LineBreak/>You have to got out in 30 minutes
                <LineBreak/>    -   Return all cities with "Raid Return" in the range of -20 .. 30
                <LineBreak/>    -   Use "Home Please" to return raids that:
                <LineBreak/>        -  Have started within the last 20 minutes, or
                <LineBreak/>        -  Will return within the next 30 minutes
                <LineBreak/>Alternatively, use "Home Whenever" to encourage raiders to complete thier raids before returning
</TextBlock>
        </winui:TeachingTip>
    </Grid>
</view:UserTab>
